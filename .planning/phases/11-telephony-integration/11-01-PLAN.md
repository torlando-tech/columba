---
phase: 11-telephony-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - reticulum/src/main/java/com/lxmf/messenger/reticulum/call/telephone/Profile.kt
  - reticulum/src/main/java/com/lxmf/messenger/reticulum/call/telephone/NetworkTransport.kt
autonomous: true

must_haves:
  truths:
    - "All 8 quality profiles have correct IDs matching Python LXST"
    - "Each profile can create its corresponding codec"
    - "NetworkTransport interface abstracts Python bridge"
  artifacts:
    - path: "reticulum/src/main/java/com/lxmf/messenger/reticulum/call/telephone/Profile.kt"
      provides: "Quality profile definitions with embedded codec config"
      exports: ["Profile", "Profile.ULBW", "Profile.VLBW", "Profile.LBW", "Profile.MQ", "Profile.HQ", "Profile.SHQ", "Profile.LL", "Profile.ULL"]
    - path: "reticulum/src/main/java/com/lxmf/messenger/reticulum/call/telephone/NetworkTransport.kt"
      provides: "Network abstraction interface for future pure-Kotlin Reticulum"
      exports: ["NetworkTransport"]
  key_links:
    - from: "Profile.kt"
      to: "audio/codec/Opus.kt, audio/codec/Codec2.kt"
      via: "Profile.createCodec() returns codec instance"
      pattern: "createCodec.*Opus|Codec2"
---

<objective>
Create Profile sealed class and NetworkTransport interface as foundation for Telephone class.

Purpose: Profile class defines all 8 quality profiles (ULBW through ULL) with embedded codec configuration. NetworkTransport interface abstracts Python bridge for future pure-Kotlin Reticulum support.

Output:
- Profile.kt with sealed class and 8 profile objects
- NetworkTransport.kt with network abstraction interface
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-telephony-integration/11-RESEARCH.md
@.planning/phases/11-telephony-integration/11-CONTEXT.md

# Reference files
@reticulum/src/main/java/com/lxmf/messenger/reticulum/audio/codec/Opus.kt
@reticulum/src/main/java/com/lxmf/messenger/reticulum/audio/codec/Codec2.kt
@reticulum/src/main/java/com/lxmf/messenger/reticulum/audio/lxst/Signalling.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Profile sealed class with all 8 quality profiles</name>
  <files>reticulum/src/main/java/com/lxmf/messenger/reticulum/call/telephone/Profile.kt</files>
  <action>
Create new file `reticulum/src/main/java/com/lxmf/messenger/reticulum/call/telephone/Profile.kt`.

Create sealed class Profile with:
- Properties: id (Int), name (String), abbreviation (String), frameTimeMs (Int)
- Abstract fun createCodec(): Codec

Define 8 profile objects matching Python LXST Telephony.py (lines 19-93):

| Profile | ID | Name | Abbrev | Frame Time | Codec |
|---------|-----|------|--------|------------|-------|
| ULBW | 0x10 | Ultra Low Bandwidth | ULBW | 400ms | Codec2(CODEC2_700C) |
| VLBW | 0x20 | Very Low Bandwidth | VLBW | 320ms | Codec2(CODEC2_1600) |
| LBW | 0x30 | Low Bandwidth | LBW | 200ms | Codec2(CODEC2_3200) |
| MQ | 0x40 | Medium Quality | MQ | 60ms | Opus(PROFILE_VOICE_MEDIUM) |
| HQ | 0x50 | High Quality | HQ | 60ms | Opus(PROFILE_VOICE_HIGH) |
| SHQ | 0x60 | Super High Quality | SHQ | 60ms | Opus(PROFILE_VOICE_MAX) |
| LL | 0x70 | Low Latency | LL | 20ms | Opus(PROFILE_VOICE_MEDIUM) |
| ULL | 0x80 | Ultra Low Latency | ULL | 10ms | Opus(PROFILE_VOICE_MEDIUM) |

Add companion object with:
- val DEFAULT = MQ
- val all: List<Profile> (ordered list of all profiles)
- fun fromId(id: Int): Profile? (lookup by ID)
- fun next(profile: Profile): Profile (cycle to next profile)

Note: Import Opus and Codec2 from audio.codec package. Use Opus profile constants (PROFILE_VOICE_MEDIUM, PROFILE_VOICE_HIGH, PROFILE_VOICE_MAX) and Codec2 mode constants (CODEC2_700C, CODEC2_1600, CODEC2_3200).
  </action>
  <verify>
File compiles without errors:
```bash
cd /home/tyler/repos/public/columba && JAVA_HOME=/home/tyler/android-studio/jbr ./gradlew :reticulum:compileDebugKotlin 2>&1 | head -50
```
  </verify>
  <done>
Profile.kt exists with all 8 profiles correctly configured. Each profile.createCodec() returns the correct codec type with correct mode/profile.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create NetworkTransport interface</name>
  <files>reticulum/src/main/java/com/lxmf/messenger/reticulum/call/telephone/NetworkTransport.kt</files>
  <action>
Create new file `reticulum/src/main/java/com/lxmf/messenger/reticulum/call/telephone/NetworkTransport.kt`.

Define interface NetworkTransport with methods for network abstraction (from 11-RESEARCH.md):

```kotlin
interface NetworkTransport {
    /** Set up link to destination for call */
    suspend fun establishLink(destinationHash: ByteArray): Boolean

    /** Tear down active link */
    fun teardownLink()

    /** Send encoded audio packet to remote */
    fun sendPacket(encodedFrame: ByteArray)

    /** Send signalling to remote */
    fun sendSignal(signal: Int)

    /** Register callback for incoming packets */
    fun setPacketCallback(callback: (ByteArray) -> Unit)

    /** Register callback for incoming signals */
    fun setSignalCallback(callback: (Int) -> Unit)

    /** Check if link is active */
    val isLinkActive: Boolean
}
```

This interface:
- Abstracts Python Chaquopy bridge
- Future-proofs for pure Kotlin Reticulum implementation
- Telephone class uses this instead of PyObject directly (CONTEXT.md decision)

Note: The Python bridge implementation (PythonNetworkTransport) will be created in Plan 02 alongside the Telephone class, since it requires integrating with NetworkPacketBridge and call_manager.
  </action>
  <verify>
File compiles without errors:
```bash
cd /home/tyler/repos/public/columba && JAVA_HOME=/home/tyler/android-studio/jbr ./gradlew :reticulum:compileDebugKotlin 2>&1 | head -50
```
  </verify>
  <done>
NetworkTransport.kt exists with complete interface definition. Interface is ready for implementation by Python bridge or future Kotlin Reticulum.
  </done>
</task>

</tasks>

<verification>
Both files compile successfully:
```bash
cd /home/tyler/repos/public/columba && JAVA_HOME=/home/tyler/android-studio/jbr ./gradlew :reticulum:compileDebugKotlin --info 2>&1 | grep -E "(BUILD|error|Profile|NetworkTransport)"
```

Profile IDs match Python LXST:
- ULBW = 0x10, VLBW = 0x20, LBW = 0x30
- MQ = 0x40, HQ = 0x50, SHQ = 0x60
- LL = 0x70, ULL = 0x80
</verification>

<success_criteria>
1. Profile sealed class with 8 profile objects compiles
2. Each profile has correct ID, name, abbreviation, frameTimeMs
3. Profile.createCodec() returns correct Opus/Codec2 instance with correct mode
4. NetworkTransport interface compiles with all required methods
5. No compile errors in reticulum module
</success_criteria>

<output>
After completion, create `.planning/phases/11-telephony-integration/11-01-SUMMARY.md`
</output>
