---
phase: 02.3-loading-states-for-tabs
plan: 01
subsystem: ui
tags: [compose, stateflow, loading-states, ux]

# Dependency graph
requires:
  - phase: 02.2-offline-maps
    provides: completed foundation phases, MapViewModel loading state pattern
provides:
  - ChatsState data class with isLoading flag for Chats tab
  - ContactsState data class with isLoading flag for Contacts tab
  - LoadingConversationsState composable for Chats loading UI
  - LoadingContactsState composable for Contacts loading UI
  - Pattern for preventing empty state flash during data load
affects: [future-ui-tabs, any-new-tabs-with-loading-states]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "State wrapper pattern: wrap List<T> in data class with isLoading flag"
    - "Loading state check before empty state in when expression"
    - "Use map{} operator to transform Flow<List<T>> to Flow<State<T>>"

key-files:
  created: []
  modified:
    - app/src/main/java/com/lxmf/messenger/viewmodel/ChatsViewModel.kt
    - app/src/main/java/com/lxmf/messenger/ui/screens/ChatsScreen.kt
    - app/src/main/java/com/lxmf/messenger/viewmodel/ContactsViewModel.kt
    - app/src/main/java/com/lxmf/messenger/ui/screens/ContactsScreen.kt

key-decisions:
  - "Use boolean isLoading flag pattern (consistent with MapViewModel) instead of sealed class UiState"
  - "Use map{} operator on Flow to wrap data with state, simpler than combine()"
  - "Loading state only for initial load, not during search filtering"

patterns-established:
  - "State wrapper: data class XState(val data: T, val isLoading: Boolean = true)"
  - "Loading check: when { isLoading -> Loading; data.isEmpty() -> Empty; else -> Content }"

# Metrics
duration: 9m 12s
completed: 2026-01-28
---

# Phase 02.3 Plan 01: Loading States for Tabs Summary

**State wrapper pattern for Chats and Contacts tabs with isLoading flag prevents empty state flash during data load**

## Performance

- **Duration:** 9m 12s
- **Started:** 2026-01-28T23:22:25Z
- **Completed:** 2026-01-28T23:31:37Z
- **Tasks:** 2
- **Files modified:** 4

## Accomplishments
- ChatsState data class wraps conversations list with isLoading flag
- ContactsState data class wraps grouped contacts with isLoading flag
- LoadingConversationsState composable shows spinner + "Loading conversations..." text
- LoadingContactsState composable shows spinner + "Loading contacts..." text
- Both screens now check isLoading before showing empty state, preventing the flash

## Task Commits

Each task was committed atomically:

1. **Task 1: Add loading states to ChatsViewModel and ChatsScreen** - `b5137705` (feat)
2. **Task 2: Add loading states to ContactsViewModel and ContactsScreen** - `d85fa290` (feat)

## Files Created/Modified
- `app/src/main/java/com/lxmf/messenger/viewmodel/ChatsViewModel.kt` - Added ChatsState, replaced conversations with chatsState
- `app/src/main/java/com/lxmf/messenger/ui/screens/ChatsScreen.kt` - Added LoadingConversationsState, updated when block
- `app/src/main/java/com/lxmf/messenger/viewmodel/ContactsViewModel.kt` - Added ContactsState, replaced groupedContacts with contactsState
- `app/src/main/java/com/lxmf/messenger/ui/screens/ContactsScreen.kt` - Added LoadingContactsState, updated when block

## Decisions Made
- Used boolean isLoading flag pattern (MapViewModel consistency) instead of sealed class UiState
- Used map{} operator on Flow to transform data to state (simpler than combine with MutableStateFlow)
- Loading state only appears on initial load, search filtering is instant (data is already loaded)

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
- Linter kept removing unused `map` import until the code actually used it - resolved by adding import after code using it
- Brace counting mismatch from when block needed extra indentation fix - resolved by verifying structure with brace counting script

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Issue #341 (loading states flash) is now fixed
- Users will see "Loading conversations..." and "Loading contacts..." on initial load
- Empty states only appear when data has loaded AND is actually empty
- Pattern established for any future tabs that need loading states

---
*Phase: 02.3-loading-states-for-tabs*
*Completed: 2026-01-28*
