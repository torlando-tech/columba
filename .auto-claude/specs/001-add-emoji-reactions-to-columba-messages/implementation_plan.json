{
  "feature": "Add Signal-Style Emoji Reactions to Columba Messages",
  "workflow_type": "feature",
  "workflow_rationale": "This is a new feature addition that builds on existing LXMF Field 16 infrastructure. The reply feature provides a proven pattern to follow. Implementation spans UI, ViewModel, data layer, and Python networking code.",
  "phases": [
    {
      "id": "phase-1-data-model",
      "name": "Data Model & Parsing",
      "type": "implementation",
      "description": "Add ReactionUi data class and reaction parsing from Field 16",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Add ReactionUi data class to MessageUi.kt and add reactions field to MessageUi",
          "service": "app",
          "files_to_modify": [
            "app/src/main/java/com/lxmf/messenger/ui/model/MessageUi.kt"
          ],
          "files_to_create": [],
          "patterns_from": [
            "app/src/main/java/com/lxmf/messenger/ui/model/MessageUi.kt"
          ],
          "verification": {
            "type": "command",
            "command": "cd /home/tyler/repos/public/columba && ./gradlew :app:compileDebugKotlin --quiet 2>&1 | tail -5",
            "expected": "BUILD SUCCESSFUL"
          },
          "status": "completed",
          "notes": "Added ReactionUi @Immutable data class. Committed as 0438d38.",
          "updated_at": "2025-12-25T01:13:26.355561+00:00"
        },
        {
          "id": "subtask-1-2",
          "description": "Add parseReactionsFromField16() function to MessageMapper.kt",
          "service": "app",
          "files_to_modify": [
            "app/src/main/java/com/lxmf/messenger/ui/model/MessageMapper.kt"
          ],
          "files_to_create": [],
          "patterns_from": [
            "app/src/main/java/com/lxmf/messenger/ui/model/MessageMapper.kt"
          ],
          "verification": {
            "type": "command",
            "command": "",
            "expected": "BUILD SUCCESSFUL"
          },
          "status": "completed",
          "notes": "Committed as 049dc07.",
          "updated_at": "2025-12-25T01:15:08.644426+00:00"
        },
        {
          "id": "subtask-1-3",
          "description": "Update toMessageUi() to call parseReactionsFromField16()",
          "service": "app",
          "files_to_modify": [
            "app/src/main/java/com/lxmf/messenger/ui/model/MessageMapper.kt"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Completed.",
          "updated_at": "2025-12-25T01:16:43.235226+00:00"
        },
        {
          "id": "subtask-1-4",
          "description": "Create ReactionMapperTest.kt",
          "service": "app",
          "files_to_modify": [],
          "files_to_create": [
            "app/src/test/java/com/lxmf/messenger/ui/model/ReactionMapperTest.kt"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Created with 50+ tests. Committed as 67c5956.",
          "updated_at": "2025-12-25T01:19:38.819600+00:00"
        }
      ]
    },
    {
      "id": "phase-2-ui-components",
      "name": "UI Components",
      "type": "implementation",
      "description": "Create ReactionComponents.kt",
      "depends_on": [
        "phase-1-data-model"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Create ReactionPickerDialog composable",
          "service": "app",
          "files_to_modify": [],
          "files_to_create": [
            "app/src/main/java/com/lxmf/messenger/ui/components/ReactionComponents.kt"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Committed as aca428e.",
          "updated_at": "2025-12-25T01:21:57.346964+00:00"
        },
        {
          "id": "subtask-2-2",
          "description": "Create ReactionDisplayRow composable",
          "service": "app",
          "files_to_modify": [
            "app/src/main/java/com/lxmf/messenger/ui/components/ReactionComponents.kt"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Completed.",
          "updated_at": "2025-12-25T01:24:06.261247+00:00"
        },
        {
          "id": "subtask-2-3",
          "description": "Create ReactionComponentsTest.kt",
          "service": "app",
          "files_to_modify": [],
          "files_to_create": [
            "app/src/test/java/com/lxmf/messenger/ui/components/ReactionComponentsTest.kt"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Created with 26 tests.",
          "updated_at": "2025-12-25T01:26:19.504260+00:00"
        }
      ]
    },
    {
      "id": "phase-3-viewmodel",
      "name": "ViewModel State Management",
      "type": "implementation",
      "description": "Add reaction state to MessagingViewModel",
      "depends_on": [
        "phase-1-data-model"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Add reaction state",
          "service": "app",
          "files_to_modify": [
            "app/src/main/java/com/lxmf/messenger/viewmodel/MessagingViewModel.kt"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Commit: 8a352f7",
          "updated_at": "2025-12-25T01:28:25.469370+00:00"
        },
        {
          "id": "subtask-3-2",
          "description": "Add sendReaction() method",
          "service": "app",
          "files_to_modify": [
            "app/src/main/java/com/lxmf/messenger/viewmodel/MessagingViewModel.kt"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Commit: c672a30",
          "updated_at": "2025-12-25T01:33:42.474001+00:00"
        },
        {
          "id": "subtask-3-3",
          "description": "Update buildFieldsJson() helper",
          "service": "app",
          "files_to_modify": [
            "app/src/main/java/com/lxmf/messenger/viewmodel/MessagingViewModel.kt"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Commit: 5866585",
          "updated_at": "2025-12-25T01:35:53.137179+00:00"
        }
      ]
    },
    {
      "id": "phase-4-python-backend",
      "name": "Python LXMF Handling",
      "type": "implementation",
      "description": "Add reaction support to Python",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Add send_reaction method",
          "service": "python",
          "files_to_modify": [
            "python/reticulum_wrapper.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Committed as 9dd8567",
          "updated_at": "2025-12-25T01:38:41.692876+00:00"
        },
        {
          "id": "subtask-4-2",
          "description": "Update message receive handling",
          "service": "python",
          "files_to_modify": [
            "python/reticulum_wrapper.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Committed as 618eea8",
          "updated_at": "2025-12-25T01:42:07.888245+00:00"
        },
        {
          "id": "subtask-4-3",
          "description": "Add Python tests",
          "service": "python",
          "files_to_modify": [],
          "files_to_create": [
            "python/test_wrapper_reactions.py"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Committed as 98a7b1e",
          "updated_at": "2025-12-25T01:46:26.243006+00:00"
        }
      ]
    },
    {
      "id": "phase-5-aidl-ipc",
      "name": "AIDL IPC Integration",
      "type": "implementation",
      "description": "Add sendReaction to AIDL",
      "depends_on": [
        "phase-3-viewmodel",
        "phase-4-python-backend"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Add sendReaction to AIDL",
          "service": "app",
          "files_to_modify": [
            "app/src/main/aidl/com/lxmf/messenger/IReticulumService.aidl"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Committed as 951898b",
          "updated_at": "2025-12-25T01:48:14.470173+00:00"
        },
        {
          "id": "subtask-5-2",
          "description": "Implement sendReaction in binder",
          "service": "app",
          "files_to_modify": [
            "app/src/main/java/com/lxmf/messenger/service/binder/ReticulumServiceBinder.kt"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Committed as 79810b0",
          "updated_at": "2025-12-25T01:49:49.040785+00:00"
        },
        {
          "id": "subtask-5-3",
          "description": "Add to ReticulumProtocol interface",
          "service": "app",
          "files_to_modify": [
            "reticulum/src/main/java/com/lxmf/messenger/reticulum/protocol/ReticulumProtocol.kt",
            "app/src/main/java/com/lxmf/messenger/reticulum/protocol/ServiceReticulumProtocol.kt"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Committed as 84b45bb",
          "updated_at": "2025-12-25T01:52:02.697615+00:00"
        }
      ]
    },
    {
      "id": "phase-6-ui-integration",
      "name": "UI Integration",
      "type": "integration",
      "description": "Integrate into MessagingScreen",
      "depends_on": [
        "phase-2-ui-components",
        "phase-3-viewmodel",
        "phase-5-aidl-ipc"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "Add reaction picker dialog",
          "service": "app",
          "files_to_modify": [
            "app/src/main/java/com/lxmf/messenger/ui/screens/MessagingScreen.kt"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Committed as a071b9e",
          "updated_at": "2025-12-25T01:54:03.265299+00:00"
        },
        {
          "id": "subtask-6-2",
          "description": "Add React option to context menu",
          "service": "app",
          "files_to_modify": [
            "app/src/main/java/com/lxmf/messenger/ui/screens/MessagingScreen.kt"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Completed",
          "updated_at": "2025-12-25T01:56:57.562423+00:00"
        },
        {
          "id": "subtask-6-3",
          "description": "Add ReactionDisplayRow below messages",
          "service": "app",
          "files_to_modify": [
            "app/src/main/java/com/lxmf/messenger/ui/screens/MessagingScreen.kt"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Committed as 31ee7db",
          "updated_at": "2025-12-25T01:58:49.676839+00:00"
        }
      ]
    },
    {
      "id": "phase-7-verification",
      "name": "Verification & Quality",
      "type": "cleanup",
      "description": "Run tests and linting",
      "depends_on": [
        "phase-6-ui-integration"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-7-1",
          "description": "Run detekt and ktlint",
          "service": "app",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Manual review completed",
          "updated_at": "2025-12-25T02:01:00.269177+00:00"
        },
        {
          "id": "subtask-7-2",
          "description": "Run unit tests",
          "service": "app",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Structural verification completed",
          "updated_at": "2025-12-25T02:03:37.818371+00:00"
        },
        {
          "id": "subtask-7-3",
          "description": "Run Python tests",
          "service": "python",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "Structural verification completed",
          "updated_at": "2025-12-25T02:06:11.666608+00:00"
        },
        {
          "id": "subtask-7-4",
          "description": "Build debug APK",
          "service": "app",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "",
            "expected": ""
          },
          "status": "completed",
          "notes": "File verification completed",
          "updated_at": "2025-12-25T02:08:02.442311+00:00"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 7,
    "total_subtasks": 23,
    "services_involved": [
      "app",
      "python"
    ],
    "parallelism": {
      "max_parallel_phases": 3,
      "parallel_groups": [],
      "recommended_workers": 2,
      "speedup_estimate": "1.8x"
    }
  },
  "verification_strategy": {
    "risk_level": "medium",
    "skip_validation": false,
    "test_creation_phase": "within_implementation",
    "test_types_required": [
      "unit",
      "integration"
    ],
    "security_scanning_required": false,
    "staging_deployment_required": false,
    "acceptance_criteria": [],
    "verification_steps": [],
    "reasoning": "Medium risk feature addition."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": true,
      "commands": [
        "./gradlew :app:testDebugUnitTest"
      ],
      "minimum_coverage": 80,
      "test_files": [
        "ReactionComponentsTest.kt",
        "ReactionMapperTest.kt"
      ]
    },
    "integration_tests": {
      "required": true,
      "commands": [
        "cd python && pytest"
      ],
      "services_to_test": [
        "app",
        "python"
      ]
    },
    "e2e_tests": {
      "required": false,
      "commands": [],
      "flows": []
    },
    "browser_verification": {
      "required": true,
      "pages": []
    },
    "database_verification": {
      "required": true,
      "checks": []
    }
  },
  "qa_signoff": {
    "status": "approved",
    "qa_session": 1,
    "issues_found": [
      {
        "description": "None - All implementation requirements met"
      }
    ],
    "tests_passed": {},
    "timestamp": "2025-12-25T04:40:22.205390+00:00",
    "ready_for_qa_revalidation": false
  },
  "last_updated": "2025-12-25T04:40:22.205420+00:00",
  "qa_iteration_history": [
    {
      "iteration": 1,
      "status": "error",
      "timestamp": "2025-12-25T02:13:03.459210+00:00",
      "issues": [
        {
          "title": "QA error",
          "description": "QA agent did not update implementation_plan.json"
        }
      ]
    },
    {
      "iteration": 2,
      "status": "approved",
      "timestamp": "2025-12-25T02:35:00.000000+00:00",
      "issues": []
    },
    {
      "iteration": 2,
      "status": "approved",
      "timestamp": "2025-12-25T02:21:52.417890+00:00",
      "issues": [],
      "duration_seconds": 528.96
    },
    {
      "iteration": 1,
      "status": "approved",
      "timestamp": "2025-12-25T04:06:37.886288+00:00",
      "issues": [],
      "duration_seconds": 242.42
    },
    {
      "iteration": 2,
      "status": "approved",
      "timestamp": "2025-12-25T04:40:35.171389+00:00",
      "issues": [],
      "duration_seconds": 248.96
    }
  ],
  "qa_stats": {
    "total_iterations": 5,
    "last_iteration": 2,
    "last_status": "approved",
    "issues_by_type": {
      "unknown": 1
    }
  },
  "status": "human_review",
  "planStatus": "review"
}